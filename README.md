# R21-doppler
## Running the program
Open and run the file 'cbfFull.py'. 

Follow the prompts to:
- Select the folderpath containing the videos to be analyzed.
- Input a name for the excel file to be generated by the program.
- Select the method of analysis (Doppler will analyzed only videos for blood flow velocity, Colormode will additionally analyze videos for vessel diameters).
- Select the files to be analyzed. Multiple baseline or hyperemic Doppler videos should be selected all at once. For Colormode analysis, only one baseline and hyperemic colormode file each should be selected.
- If Colormode analysis was selected, input the probe angle and maximum/minimum penetration depth (indicated below).

![colormodeInput](https://user-images.githubusercontent.com/57882373/155819942-1d9129f0-d193-47d9-a8d1-dffbfb441b31.png)

The program will automatically parse each video file into a single image and attempt to binarize the image in order to capture the Doppler envelope and remove. The user can verify or adjust this threshold value in the 'Scroll Test' window that appears (shown below).

<img width="1294" alt="Screen Shot 2022-02-25 at 7 11 06 PM" src="https://user-images.githubusercontent.com/57882373/155819957-1ebce476-8267-4cd3-8fe0-07033c30fc15.png">

The program will complete its analysis and output the following files:
- An excel file with the input name containing all calculated data points. This will be in the same directory as the analyzed video files.
- Images named using the input file name + "_#", labeled in the order that video files were analyzed. These images label the following data points for each cardiac cycle: beginning of cycle (green), peak velocity (yellow), decay velocity (pink), peak diastolic deceleration (red), and end of cycle (blue).
- For colormode analysis, images named "baseline_###" and "hyperemic_###", with numbers corresponding to that image's identified vessel diameter.
